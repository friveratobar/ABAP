<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=ISO-8859-1" />
<title>ZSD614</title>
<style type="text/css">
.code{ font-family:"Courier New", Courier, monospace; color:#000; font-size:14px; background-color:#F2F4F7 }
  .codeComment {font-family:"Courier New", Courier, monospace; color:#0000F0; font-size:14px; background-color:#F2F4F7 }
  .normalBold{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; font-weight:800 }
  .normalBoldLarge{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
</style>
<style type="text/css">
  .normal{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px }
  .footer{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:12px; text-align: center }
  h2{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:16px; font-weight:800 }
  h3{ font-family:Arial, Helvetica, sans-serif; color:#000; font-size:14px; font-weight:800 }
  .outerTable{
   background-color:#E0E7ED;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-right-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
  .innerTable{
   background-color:#F2F4F7;
   width:100%;
   border-top-width: thin;
   border-right-width: thin;
   border-bottom-width: thin;
   border-left-width: thin;
   border-top-style: solid;
   border-right-style: solid;
   border-bottom-style: solid;
   border-left-style: solid;
  }
</style>
</head>
<body>
<table class="outerTable">
  <tr class="normalBoldLarge">
     <td><h2>Code listing for: ZSD614</h2>
<h3> Description: </h3></td>
   </tr>
  <tr>
     <td>
     <table class="innerTable">
       <tr>
          <td>
   <div class="codeComment">
*&-------------------------------------------------------------------*<br />
*&&nbsp;Report&nbsp;&nbsp;ACC_BAPI_SXDA_DOCUMENT_POST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&-------------------------------------------------------------------*<br />
*&&nbsp;Test&nbsp;report&nbsp;for&nbsp;SXDA&nbsp;Data&nbsp;Workbench&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&-------------------------------------------------------------------*<br />
*--------------------------------------------------------------------*<br />
*&nbsp;PROGRAMA&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;ZSD614&nbsp;(&nbsp;Basado&nbsp;en&nbsp;ZSD610&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;FER&nbsp;N�&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;CHARM&nbsp;N�&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;S&nbsp;9000008807&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;TIPO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Interfaz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;AUTOR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Felipe&nbsp;Rivera&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;SOLICITANTE&nbsp;:&nbsp;*****&nbsp;******&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;FECHA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;25/02/2019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*&nbsp;OBJETIVO&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Contabilizaci�n&nbsp;Ventas&nbsp;Intercompany&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&nbsp;O&nbsp;D&nbsp;I&nbsp;F&nbsp;I&nbsp;C&nbsp;A&nbsp;C&nbsp;I&nbsp;O&nbsp;N&nbsp;E&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
REPORT zsd614.<br />
<br />
DATA tvbdpr TYPE TABLE OF vbdpr WITH HEADER LINE.<br />
<br />
DATA: BEGIN OF tkomv OCCURS 50.<br />
&nbsp;&nbsp;&nbsp;&nbsp;INCLUDE&nbsp;STRUCTURE&nbsp;komv.<br />
DATA: END OF tkomv.<br />
<br />
DATA: BEGIN OF tkomvd OCCURS 50.<br />
&nbsp;&nbsp;&nbsp;&nbsp;INCLUDE&nbsp;STRUCTURE&nbsp;komvd.<br />
DATA: END OF tkomvd.<br />
<br />
PARAMETERS: receiver LIKE tbdlst-logsys NO-DISPLAY.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;Definition&nbsp;of&nbsp;tables&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
TABLES: nast,                         "Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*nast.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Messages<br />
<br />
TABLES: komk,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;komp,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vbdkr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tvko.<br />
<br />
DATA: anzal LIKE nast-anzal.          "HUNGARY<br />
DATA: nast_anzal LIKE nast-anzal.     "Number of outputs (Orig. + Cop.)<br />
<br />
TABLES: vbco3   ,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vbdkr&nbsp;&nbsp;&nbsp;,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vbdpr&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vbdre&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conf_out,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sadr&nbsp;&nbsp;&nbsp;&nbsp;,<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tvko&nbsp;&nbsp;&nbsp;&nbsp;,<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adrs&nbsp;&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t005&nbsp;&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t001&nbsp;&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t001g&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tvcint&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;konh&nbsp;&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tlic&nbsp;&nbsp;&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fpltvb&nbsp;&nbsp;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sdaccdpc.<br />
<br />
DATA: BEGIN OF itg_header OCCURS 0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comp_code&nbsp;&nbsp;TYPE&nbsp;t001-bukrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ref_doc_no&nbsp;TYPE&nbsp;bkpf-xblnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc_date&nbsp;&nbsp;&nbsp;TYPE&nbsp;bkpf-bldat,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pstng_date&nbsp;TYPE&nbsp;bkpf-budat,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doc_type&nbsp;&nbsp;&nbsp;TYPE&nbsp;bkpf-blart,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header_txt&nbsp;TYPE&nbsp;bkpf-bktxt,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END&nbsp;OF&nbsp;itg_header.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;Constantes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
CONSTANTS: c_zzr5(004) TYPE c VALUE 'ZZR5',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_bkpff(05)&nbsp;TYPE&nbsp;c&nbsp;VALUE&nbsp;'BKPFF',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_x(001)&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;c&nbsp;VALUE&nbsp;'X',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_vv01&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;thead-tdid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;'VV01',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_vbbp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;thead-tdobject&nbsp;VALUE&nbsp;'VBBP',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;thead-tdid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VALUE&nbsp;'0001',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c_vbbk&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;thead-tdobject&nbsp;VALUE&nbsp;'VBBK'.<br />
<br />
DATA:<br />
&nbsp;&nbsp;gd_documentheader&nbsp;LIKE&nbsp;bapiache09,<br />
&nbsp;&nbsp;it_return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;TABLE&nbsp;OF&nbsp;bapiret2&nbsp;&nbsp;&nbsp;WITH&nbsp;HEADER&nbsp;LINE.<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;Tablas&nbsp;Internas&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_accountgl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;bapiacgl09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;itg_accounttax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;bapiactx09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;itg_currencyamount&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;bapiaccr09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;itg_return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;bapiret2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;itg_accountpayable&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;bapiacap09.<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;Work&nbsp;area&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bapiacgl09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;stg_accounttax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bapiactx09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;stg_currencyamount&nbsp;TYPE&nbsp;bapiaccr09<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;stg_return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bapiret2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;stg_accountpayable&nbsp;TYPE&nbsp;bapiacap09.<br />
<br />
DATA: BEGIN OF stl_obj<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;obj_type&nbsp;&nbsp;LIKE&nbsp;&nbsp;bapiache09-obj_type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;obj_key&nbsp;&nbsp;&nbsp;LIKE&nbsp;&nbsp;bapiache09-obj_key<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;obj_sys&nbsp;&nbsp;&nbsp;LIKE&nbsp;&nbsp;bapiache09-obj_sys<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;END&nbsp;OF&nbsp;stl_obj.<br />
<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;Variables&nbsp;Globales&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
DATA  gv_tax_code TYPE mwskz.<br />
DATA  gv_lines    TYPE i.<br />
DATA  vg_error    TYPE c LENGTH 001.<br />
DATA  i_error     TYPE c LENGTH 001.<br />
DATA  gv_kunnr    TYPE tvko-kunnr.<br />
DATA  gv_factor   TYPE char2 VALUE 1.<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;Specific&nbsp;data&nbsp;of&nbsp;ENTRY_CH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
DATA print_local_curr_ch.<br />
DATA komvdk_ch LIKE komvd OCCURS 10 WITH HEADER LINE.<br />
DATA komvdp_ch LIKE komvd OCCURS 10 WITH HEADER LINE.<br />
   </div>
   <div class="codeComment">
*--------------------------------------------------------------------*<br />
*&nbsp;ENTRY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*--------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM entry USING return_code us_screen.<br />
&nbsp;&nbsp;PERFORM&nbsp;authority_check.<br />
&nbsp;&nbsp;PERFORM&nbsp;fill_internal_tables.<br />
&nbsp;&nbsp;PERFORM&nbsp;f_ale_acc_doc.<br />
&nbsp;&nbsp;IF&nbsp;vg_error&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;return_code&nbsp;=&nbsp;0.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;return_code&nbsp;=&nbsp;3.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    "ENTRY<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;F_ALE_ACC_DOC<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM f_ale_acc_doc.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_ACC_DOCUMENT_POST'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;documentheader&nbsp;=&nbsp;gd_documentheader<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;stl_obj-obj_type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj_key&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;stl_obj-obj_key<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj_sys&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;stl_obj-obj_sys<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accountpayable&nbsp;=&nbsp;itg_accountpayable<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accountgl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;itg_accountgl<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currencyamount&nbsp;=&nbsp;itg_currencyamount<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accounttax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;itg_accounttax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return.<br />
<br />
&nbsp;&nbsp;"code&nbsp;Inspector&nbsp;Ok.<br />
&nbsp;&nbsp;CLEAR&nbsp;vg_error.<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;it_return&nbsp;WHERE&nbsp;type&nbsp;EQ&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;vg_error&nbsp;=&nbsp;c_x.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NAST_PROTOCOL_UPDATE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_arbgb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_nr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_ty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message_type_not_valid&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_sy_message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
&nbsp;&nbsp;IF&nbsp;vg_error&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;it_return.<br />
&nbsp;&nbsp;&nbsp;&nbsp;it_return-id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'69'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;it_return-number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'260'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;it_return-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'S'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;it_return-message_v1&nbsp;&nbsp;=&nbsp;stl_obj-obj_key.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'NAST_PROTOCOL_UPDATE'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_arbgb&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_nr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_ty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg_v4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;it_return-message_v4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message_type_not_valid&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_sy_message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-batch&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMIT&nbsp;WORK.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;PERFORM&nbsp;show_messages.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;REFRESH:&nbsp;itg_accountgl,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_currencyamount,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_return,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_accountpayable,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_accounttax.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;gd_documentheader.<br />
<br />
ENDFORM.                    "F_ALE_ACC_DOC<br />
<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;fill_internal_tables<br />
*---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_internal_tables.<br />
   </div>
   <div class="codeComment">
*&nbsp;PERFORM&nbsp;get_data&nbsp;IN&nbsp;PROGRAM&nbsp;rvadin01.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;"Search&nbsp;Data&nbsp;/&nbsp;Info&nbsp;documento&nbsp;ventas<br />
&nbsp;&nbsp;PERFORM&nbsp;fill_data.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Rutina&nbsp;de&nbsp;Busqueda&nbsp;de&nbsp;data,&nbsp;y&nbsp;preparacion.<br />
&nbsp;&nbsp;PERFORM&nbsp;document_header.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Cabecera&nbsp;BAPI<br />
&nbsp;&nbsp;PERFORM&nbsp;fill_accountpayable.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Linea&nbsp;de&nbsp;proveedor<br />
&nbsp;&nbsp;PERFORM&nbsp;fill_currencyamount_prov.&nbsp;"&nbsp;Currency&nbsp;linea&nbsp;de&nbsp;proveedor<br />
&nbsp;&nbsp;PERFORM&nbsp;fill_accountgl.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Contabilizacion&nbsp;(Cta&nbsp;&nbsp;Mayor)<br />
<br />
ENDFORM.                            " fill_internal_tables<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;Show_messages<br />
*---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM show_messages.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;IF&nbsp;it_return[]&nbsp;IS&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;'no&nbsp;messages'.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;SKIP&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;it_return.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WRITE:&nbsp;/&nbsp;&nbsp;&nbsp;&nbsp;it_return-type,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)&nbsp;&nbsp;it_return-id,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_return-number,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(80)&nbsp;it_return-message,<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-LOG_NO<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-LOG_MSG_NO<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-MESSAGE_V1<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-MESSAGE_V2<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-MESSAGE_V3<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-MESSAGE_V4<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(20)&nbsp;it_return-parameter,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)&nbsp;&nbsp;it_return-row,<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it_return-field.<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IT_RETURN-SYSTEM<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDLOOP.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;ULINE.<br />
   </div>
   <div class="code">
ENDFORM.                               " Show_messages<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORM&nbsp;fill_accountgl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_accountgl.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;vl_skont&nbsp;TYPE&nbsp;t076i-skont,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_ccost&nbsp;TYPE&nbsp;bapi0012_gen-costcenter,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_carea&nbsp;TYPE&nbsp;bapi0012_gen-co_area,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_cost&nbsp;TYPE&nbsp;bapi0012_ccoutputlist,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_kokrs&nbsp;LIKE&nbsp;tka02-kokrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_bukrs&nbsp;LIKE&nbsp;t001-bukrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_name&nbsp;&nbsp;LIKE&nbsp;thead-tdname,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_xblnr&nbsp;TYPE&nbsp;bkpf-xblnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;char1&nbsp;VALUE&nbsp;'E'.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;itg_tline&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;tline.<br />
&nbsp;&nbsp;DATA&nbsp;stg_tline&nbsp;TYPE&nbsp;tline.<br />
&nbsp;&nbsp;DATA&nbsp;aux_accountgl&nbsp;TYPE&nbsp;bapiacgl09.<br />
&nbsp;&nbsp;REFRESH&nbsp;it_return.&nbsp;CLEAR&nbsp;it_return.<br />
<br />
&nbsp;&nbsp;LOOP&nbsp;AT&nbsp;tvbdpr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR:&nbsp;vl_ccost,&nbsp;vl_name,&nbsp;vl_kokrs,&nbsp;vl_carea,stg_cost.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;gv_lines.<br />
&nbsp;&nbsp;&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;itg_accountgl&nbsp;LINES&nbsp;gv_lines.<br />
<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;gv_lines&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;aux_accountgl.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_accountgl&nbsp;INTO&nbsp;aux_accountgl&nbsp;INDEX&nbsp;gv_lines.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;aux_accountgl&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-itemno_acc&nbsp;&nbsp;=&nbsp;aux_accountgl-itemno_acc&nbsp;+&nbsp;1.&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;posici�n&nbsp;del&nbsp;documento&nbsp;FI<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-itemno_acc&nbsp;&nbsp;&nbsp;=&nbsp;'2'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;cuenta_mayor&nbsp;USING&nbsp;vl_skont&nbsp;tvbdpr-matnr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-gl_account&nbsp;&nbsp;=&nbsp;vl_skont&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Cuenta&nbsp;de&nbsp;mayor&nbsp;de&nbsp;la&nbsp;contabilidad&nbsp;principal<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-acct_type&nbsp;&nbsp;&nbsp;=&nbsp;'S'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Clase&nbsp;de&nbsp;cuenta<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Clase&nbsp;de&nbsp;documento<br />
&nbsp;&nbsp;&nbsp;&nbsp;CASE&nbsp;vbdkr-vbtyp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-doc_type&nbsp;=&nbsp;'KR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'O'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-doc_type&nbsp;=&nbsp;'KC'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-doc_type&nbsp;=&nbsp;'KD'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syst-msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;protocol_update&nbsp;IN&nbsp;PROGRAM&nbsp;rvadin01.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CONCATENATE&nbsp;vbdkr-vbeln&nbsp;tvbdpr-posnr&nbsp;INTO&nbsp;vl_name.&nbsp;"Numero&nbsp;Factura&nbsp;+&nbsp;Posicion.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Centro&nbsp;de&nbsp;costo<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'READ_TEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-mandt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c_vv01<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vl_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c_vbbp<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;itg_tline<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reference_check&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrong_access_to_archive&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;stg_tline.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_tline&nbsp;INTO&nbsp;stg_tline&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;stg_tline&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_ccost&nbsp;&nbsp;=&nbsp;stg_tline-tdline.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;vl_ccost.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'CONVERSION_EXIT_ALPHA_INPUT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input&nbsp;&nbsp;=&nbsp;vl_ccost<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;=&nbsp;vl_ccost.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Variables<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'KOKRS_GET_FROM_BUKRS'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i_bukrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-bukrs&nbsp;"&nbsp;Sociedad<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e_kokrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vl_kokrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no_kokrs_found&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_carea&nbsp;=&nbsp;vl_kokrs.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_COSTCENTER_GETDETAIL1'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;controllingarea&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vl_carea&nbsp;"&nbsp;Controlling&nbsp;Area<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;costcenter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vl_ccost&nbsp;"&nbsp;Centro&nbsp;Costo<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keydate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-datum&nbsp;"&nbsp;Fecha&nbsp;Hoy<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;master_data_inactive&nbsp;=&nbsp;'&nbsp;'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;n/a<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LANGUAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;n/a<br />
   </div>
   <div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;costcenterdetail&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;stg_cost<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;itg_return.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-bus_area&nbsp;=&nbsp;stg_cost-bus_area.&nbsp;&nbsp;&nbsp;"&nbsp;�rea&nbsp;funcional<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-fis_period&nbsp;&nbsp;=&nbsp;vbdkr-fkdat+04(02).&nbsp;"&nbsp;Mes&nbsp;contable<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-fisc_year&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-fkdat+00(04).&nbsp;"&nbsp;Ejercicio<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-pstng_date&nbsp;&nbsp;=&nbsp;vbdkr-fkdat.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Fecha&nbsp;de&nbsp;contabilizaci�n&nbsp;en&nbsp;el&nbsp;documento<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-value_date&nbsp;&nbsp;=&nbsp;vbdkr-fkdat.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Fecha&nbsp;valor<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-tax_code&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;gv_tax_code.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Indicador&nbsp;IVA<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_accountgl-costcenter&nbsp;&nbsp;=&nbsp;vl_ccost.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Centro&nbsp;de&nbsp;coste<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_currencyamount_pos&nbsp;USING&nbsp;stg_accountgl-itemno_acc.&nbsp;&nbsp;"&nbsp;Importes&nbsp;Posiciones<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;tvbdpr-mwsbp&nbsp;IS&nbsp;NOT&nbsp;INITIAL.&nbsp;"&nbsp;Si&nbsp;hay&nbsp;impuesto&nbsp;por&nbsp;posicion<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_accounttax_pos&nbsp;USING&nbsp;stg_accountgl-itemno_acc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_skont.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;APPEND&nbsp;stg_accountgl&nbsp;TO&nbsp;itg_accountgl.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;stg_accountgl.<br />
<br />
&nbsp;&nbsp;ENDLOOP.<br />
<br />
ENDFORM.                    "fill_accountgl<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORM&nbsp;fill_header&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM document_header.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'OWN_LOGICAL_SYSTEM_GET'<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;own_logical_system&nbsp;=&nbsp;gd_documentheader-obj_sys.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Sistema&nbsp;l�gico&nbsp;documento&nbsp;de&nbsp;origen<br />
&nbsp;&nbsp;gd_documentheader-obj_type&nbsp;&nbsp;&nbsp;=&nbsp;c_bkpff.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Operaci�n&nbsp;de&nbsp;referencia<br />
&nbsp;&nbsp;gd_documentheader-username&nbsp;&nbsp;&nbsp;=&nbsp;sy-uname.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Nombre&nbsp;del&nbsp;usuario<br />
&nbsp;&nbsp;gd_documentheader-header_txt&nbsp;=&nbsp;itg_header-header_txt.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Texto&nbsp;de&nbsp;cabecera<br />
&nbsp;&nbsp;gd_documentheader-comp_code&nbsp;&nbsp;=&nbsp;itg_header-comp_code.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Sociedad<br />
&nbsp;&nbsp;gd_documentheader-doc_date&nbsp;&nbsp;&nbsp;=&nbsp;itg_header-doc_date.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Fecha&nbsp;de&nbsp;documento&nbsp;en&nbsp;documento<br />
&nbsp;&nbsp;gd_documentheader-pstng_date&nbsp;=&nbsp;itg_header-pstng_date.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Fecha&nbsp;de&nbsp;contabilizaci�n&nbsp;en&nbsp;el&nbsp;documento<br />
&nbsp;&nbsp;gd_documentheader-fisc_year&nbsp;&nbsp;=&nbsp;itg_header-pstng_date+00(04).&nbsp;"&nbsp;Ejercicio<br />
&nbsp;&nbsp;gd_documentheader-doc_type&nbsp;&nbsp;&nbsp;=&nbsp;itg_header-doc_type.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Clase&nbsp;de&nbsp;documento<br />
&nbsp;&nbsp;gd_documentheader-ref_doc_no&nbsp;=&nbsp;itg_header-ref_doc_no.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;documento&nbsp;de&nbsp;referencia<br />
<br />
ENDFORM.                    "fill_header<br />
   </div>
   <div class="codeComment">
*---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORM&nbsp;fill_currencyamount&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />
*---------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_currencyamount_pos  USING p_itemno_acc TYPE posnr_acc.<br />
   </div>
   <div class="codeComment">
*&nbsp;USING&nbsp;p_tabix&nbsp;TYPE&nbsp;sy-tabix.<br />
<br />
*&nbsp;Define&nbsp;factor&nbsp;+/-<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CASE&nbsp;vbdkr-vbtyp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M'.&nbsp;"&nbsp;(KR)&nbsp;Factura<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_factor&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'O'.&nbsp;"&nbsp;(KC)&nbsp;Nota&nbsp;de&nbsp;Credito<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_factor&nbsp;=&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P'.&nbsp;"&nbsp;(KD)&nbsp;Nota&nbsp;de&nbsp;Debito<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_factor&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syst-msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;protocol_update&nbsp;IN&nbsp;PROGRAM&nbsp;rvadin01.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;aux_currencyamount&nbsp;TYPE&nbsp;bapiaccr09.<br />
*<br />
*&nbsp;&nbsp;CLEAR&nbsp;gv_lines.<br />
*&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;itg_currencyamount&nbsp;LINES&nbsp;gv_lines.<br />
*<br />
*<br />
*<br />
*&nbsp;&nbsp;IF&nbsp;gv_lines&nbsp;&gt;&nbsp;0.<br />
*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;aux_currencyamount.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_currencyamount&nbsp;INTO&nbsp;aux_currencyamount&nbsp;INDEX&nbsp;p_tabix.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;stg_currencyamount&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-itemno_acc&nbsp;=&nbsp;aux_currencyamount-itemno_acc&nbsp;+&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-itemno_acc&nbsp;&nbsp;&nbsp;=&nbsp;'2'.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;stg_currencyamount-itemno_acc&nbsp;&nbsp;=&nbsp;p_itemno_acc.<br />
&nbsp;&nbsp;stg_currencyamount-currency&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tvbdpr-waerk.&nbsp;"&nbsp;Moneda<br />
<br />
&nbsp;&nbsp;"&nbsp;Importe&nbsp;en&nbsp;moneda&nbsp;de&nbsp;documento<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tvbdpr-waerk&nbsp;"&nbsp;Moneda<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;tvbdpr-netwr&nbsp;"&nbsp;Monto<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_doccur.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-amt_doccur&nbsp;&nbsp;=&nbsp;&nbsp;stg_currencyamount-amt_doccur&nbsp;*&nbsp;gv_factor.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;Importe&nbsp;en&nbsp;moneda&nbsp;de&nbsp;documento<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tvbdpr-waerk&nbsp;"&nbsp;Moneda<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;tvbdpr-netwr&nbsp;"&nbsp;Monto<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_base.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-amt_base&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;stg_currencyamount-amt_base&nbsp;*&nbsp;gv_factor.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;IF&nbsp;tvbdpr-mwsbp&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Importe&nbsp;base&nbsp;del&nbsp;impuesto&nbsp;en&nbsp;moneda&nbsp;documento<br />
&nbsp;&nbsp;&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tvbdpr-waerk&nbsp;&nbsp;"&nbsp;Moneda<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;tvbdpr-mwsbp&nbsp;&nbsp;"&nbsp;Impuesto<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-tax_amt.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-tax_amt&nbsp;=&nbsp;stg_currencyamount-tax_amt&nbsp;*&nbsp;gv_factor.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;"&nbsp;Importe&nbsp;base&nbsp;del&nbsp;impuesto&nbsp;en&nbsp;moneda&nbsp;documento<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tvbdpr-waerk&nbsp;&nbsp;"&nbsp;Moneda<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;tvbdpr-mwsbp&nbsp;"&nbsp;Impuesto<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_base.<br />
*&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-amt_base&nbsp;=&nbsp;stg_currencyamount-amt_base&nbsp;*&nbsp;gv_factor.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;APPEND&nbsp;stg_currencyamount&nbsp;TO&nbsp;itg_currencyamount.<br />
&nbsp;&nbsp;CLEAR&nbsp;stg_currencyamount.<br />
<br />
ENDFORM.                    "fill_currencyamount<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_DATA<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_data .<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;vl_name&nbsp;&nbsp;LIKE&nbsp;thead-tdname,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_xblnr&nbsp;TYPE&nbsp;bkpf-xblnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;char1&nbsp;VALUE&nbsp;'E'.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;itg_tline&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;tline.<br />
&nbsp;&nbsp;DATA&nbsp;stg_tline&nbsp;TYPE&nbsp;tline.<br />
<br />
&nbsp;&nbsp;CLEAR:&nbsp;komk,&nbsp;komp,&nbsp;nast_anzal,&nbsp;sdaccdpc,vbco3,vbdkr.<br />
&nbsp;&nbsp;REFRESH&nbsp;tvbdpr.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Chequeamos&nbsp;que&nbsp;sea&nbsp;el&nbsp;mensaje&nbsp;para&nbsp;intercompany&nbsp;nuevo.<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CHECK&nbsp;nast-kschl&nbsp;=&nbsp;c_zzr5.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RV_PRICE_PRINT_REFRESH'<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tkomv&nbsp;=&nbsp;tkomv.<br />
<br />
&nbsp;&nbsp;IF&nbsp;nast-objky+10(6)&nbsp;NE&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;vbco3-vbeln&nbsp;=&nbsp;nast-objky+16(10).<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;vbco3-vbeln&nbsp;=&nbsp;nast-objky.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;vbco3-mandt&nbsp;=&nbsp;sy-mandt.<br />
&nbsp;&nbsp;vbco3-spras&nbsp;=&nbsp;nast-spras.<br />
&nbsp;&nbsp;vbco3-kunde&nbsp;=&nbsp;nast-parnr.<br />
&nbsp;&nbsp;vbco3-parvw&nbsp;=&nbsp;nast-parvw.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RV_BILLING_PRINT_VIEW'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comwa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbco3<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kopf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr&nbsp;"kopf<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tvbdpr<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terms_of_payment_not_in_t052&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error_message&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4.<br />
<br />
&nbsp;&nbsp;IF&nbsp;NOT&nbsp;sy-subrc&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;=&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syst-msgty&nbsp;=&nbsp;'I'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;protocol_update&nbsp;IN&nbsp;PROGRAM.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;komk.<br />
&nbsp;&nbsp;komk-mandt&nbsp;=&nbsp;sy-mandt.<br />
&nbsp;&nbsp;komk-kalsm&nbsp;=&nbsp;vbdkr-kalsm.<br />
&nbsp;&nbsp;komk-fkart&nbsp;=&nbsp;vbdkr-fkart.<br />
&nbsp;&nbsp;komk-kappl&nbsp;=&nbsp;'V'.<br />
<br />
&nbsp;&nbsp;IF&nbsp;vbdkr-kappl&nbsp;NE&nbsp;space.<br />
&nbsp;&nbsp;&nbsp;&nbsp;komk-kappl&nbsp;=&nbsp;vbdkr-kappl.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;komk-waerk&nbsp;=&nbsp;vbdkr-waerk.<br />
&nbsp;&nbsp;komk-knumv&nbsp;=&nbsp;vbdkr-knumv.<br />
&nbsp;&nbsp;komk-vbtyp&nbsp;=&nbsp;vbdkr-vbtyp.<br />
&nbsp;&nbsp;komk-bukrs&nbsp;=&nbsp;vbdkr-bukrs.<br />
&nbsp;&nbsp;komk-belnr&nbsp;=&nbsp;vbdkr-vbeln.<br />
&nbsp;&nbsp;komp-kposn&nbsp;=&nbsp;vbdpr-posnr.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'RV_PRICE_PRINT_ITEM'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_head_i&nbsp;=&nbsp;komk<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_item_i&nbsp;=&nbsp;komp<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_head_e&nbsp;=&nbsp;komk<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comm_item_e&nbsp;=&nbsp;komp<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tkomv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tkomv<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tkomvd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;tkomvd.<br />
<br />
&nbsp;&nbsp;vl_name&nbsp;=&nbsp;nast-objky.&nbsp;"Numero&nbsp;Factura<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'READ_TEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-mandt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c_id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vl_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c_vbbk<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;itg_tline<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reference_check&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrong_access_to_archive&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;stg_tline.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_tline&nbsp;INTO&nbsp;stg_tline&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;stg_tline&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_header-header_txt&nbsp;=&nbsp;stg_tline-tdline.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;itg_header-comp_code&nbsp;&nbsp;=&nbsp;vbdkr-vbund.<br />
&nbsp;&nbsp;itg_header-doc_date&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-erdat.<br />
&nbsp;&nbsp;itg_header-pstng_date&nbsp;=&nbsp;vbdkr-fkdat.<br />
<br />
&nbsp;&nbsp;CASE&nbsp;vbdkr-vbtyp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_header-doc_type&nbsp;=&nbsp;'KR'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'O'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_header-doc_type&nbsp;=&nbsp;'KC'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;itg_header-doc_type&nbsp;=&nbsp;'KD'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syst-msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;protocol_update&nbsp;IN&nbsp;PROGRAM&nbsp;rvadin01.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
&nbsp;&nbsp;CONCATENATE&nbsp;vl_e&nbsp;vbdkr-xblnr&nbsp;INTO&nbsp;vl_xblnr.<br />
&nbsp;&nbsp;itg_header-ref_doc_no&nbsp;=&nbsp;vl_xblnr.<br />
<br />
&nbsp;&nbsp;CLEAR&nbsp;gv_tax_code.<br />
<br />
<br />
ENDFORM.                    " FILL_DATA<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;AUTHORITY_CHECK<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM authority_check .<br />
&nbsp;&nbsp;AUTHORITY-CHECK&nbsp;OBJECT&nbsp;'ZBC_PROGRA'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID&nbsp;'PROGRAM'&nbsp;FIELD&nbsp;sy-repid.<br />
&nbsp;&nbsp;IF&nbsp;NOT&nbsp;sy-subrc&nbsp;IS&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;MESSAGE&nbsp;e014(zi)&nbsp;WITH&nbsp;TEXT-t02.&nbsp;"'***���Sin&nbsp;autorizaci�n&nbsp;para&nbsp;correr&nbsp;este&nbsp;programa!!!***'.<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM.                    " AUTHORITY_CHECK<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_ACCOUNTPAYABLE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_accountpayable.<br />
<br />
&nbsp;&nbsp;DATA:&nbsp;vl_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIKE&nbsp;thead-tdname,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_xblnr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bkpf-xblnr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;char1&nbsp;VALUE&nbsp;'E',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_bukrs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;tvko-bukrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_zterm&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lfb1-zterm,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_zwels&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;lfb1-zwels,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_alloc_nmbr&nbsp;TYPE&nbsp;acpi_zuonr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_item_text&nbsp;&nbsp;TYPE&nbsp;sgtxt,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_buzei&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bseg-buzei,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_gjahr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bseg-gjahr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_mwskz&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bset-mwskz.<br />
<br />
&nbsp;&nbsp;DATA&nbsp;itg_tline&nbsp;TYPE&nbsp;STANDARD&nbsp;TABLE&nbsp;OF&nbsp;tline.<br />
&nbsp;&nbsp;DATA&nbsp;stg_tline&nbsp;TYPE&nbsp;tline.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;kunnr&nbsp;bukrs&nbsp;INTO&nbsp;(&nbsp;gv_kunnr,&nbsp;vl_bukrs&nbsp;)<br />
&nbsp;&nbsp;FROM&nbsp;tvko&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;WHERE&nbsp;vkorg&nbsp;EQ&nbsp;vbdkr-vkorg<br />
&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;PRIMARY&nbsp;KEY.<br />
&nbsp;&nbsp;ENDSELECT.<br />
&nbsp;&nbsp;IF&nbsp;gv_kunnr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;tax_code.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;tax_code<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;zterm&nbsp;zwels&nbsp;INTO&nbsp;(&nbsp;vl_zterm,&nbsp;vl_zwels&nbsp;)<br />
&nbsp;&nbsp;FROM&nbsp;lfb1&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;WHERE&nbsp;lifnr&nbsp;EQ&nbsp;gv_kunnr&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bukrs&nbsp;EQ&nbsp;vl_bukrs<br />
&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;PRIMARY&nbsp;KEY.<br />
&nbsp;&nbsp;ENDSELECT.<br />
<br />
&nbsp;&nbsp;CONCATENATE&nbsp;'E'&nbsp;vbdkr-xblnr&nbsp;INTO&nbsp;vl_alloc_nmbr.<br />
<br />
&nbsp;&nbsp;vl_name&nbsp;=&nbsp;vbdkr-vbeln.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'READ_TEXT'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-mandt<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c_id<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;sy-langu<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vl_name<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;c_vbbk<br />
&nbsp;&nbsp;&nbsp;&nbsp;TABLES<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lines&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;itg_tline<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXCEPTIONS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;language&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;2<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;3<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not_found&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;4<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;5<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reference_check&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrong_access_to_archive&nbsp;=&nbsp;7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OTHERS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;8.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;stg_tline.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_tline&nbsp;INTO&nbsp;stg_tline&nbsp;INDEX&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;stg_tline&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_item_text&nbsp;=&nbsp;stg_tline-tdline.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;stg_accountpayable-itemno_acc&nbsp;=&nbsp;'1'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;posici�n&nbsp;del&nbsp;documento&nbsp;FI<br />
&nbsp;&nbsp;stg_accountpayable-vendor_no&nbsp;&nbsp;=&nbsp;gv_kunnr.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;cuenta&nbsp;del&nbsp;proveedor&nbsp;o&nbsp;acreedor<br />
&nbsp;&nbsp;stg_accountpayable-pmnttrms&nbsp;&nbsp;&nbsp;=&nbsp;vl_zterm.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Clave&nbsp;de&nbsp;condiciones&nbsp;de&nbsp;pago<br />
&nbsp;&nbsp;stg_accountpayable-pymt_meth&nbsp;&nbsp;=&nbsp;vl_zwels.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;V�a&nbsp;de&nbsp;pago<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;stg_accountpayable-pmnt_block&nbsp;=&nbsp;'P'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Clave&nbsp;para&nbsp;bloqueo&nbsp;de&nbsp;pago<br />
   </div>
   <div class="code">
&nbsp;&nbsp;stg_accountpayable-alloc_nmbr&nbsp;=&nbsp;vl_alloc_nmbr.&nbsp;&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;asignaci�n<br />
&nbsp;&nbsp;stg_accountpayable-item_text&nbsp;&nbsp;=&nbsp;vl_item_text.&nbsp;&nbsp;&nbsp;"&nbsp;Texto&nbsp;posici�n<br />
&nbsp;&nbsp;stg_accountpayable-tax_code&nbsp;&nbsp;&nbsp;=&nbsp;gv_tax_code.&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Indicador&nbsp;IVA<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;stg_accountpayable&nbsp;TO&nbsp;itg_accountpayable.<br />
&nbsp;&nbsp;CLEAR&nbsp;stg_accountpayable.<br />
<br />
&nbsp;&nbsp;IF&nbsp;vbdkr-mwsbk&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;fill_accounttax_prov.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Impuestos&nbsp;Proveedor<br />
&nbsp;&nbsp;ENDIF.<br />
ENDFORM." fill_accountpayable<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;TAX_CODE<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM tax_code.<br />
<br />
&nbsp;&nbsp;DATA:<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_bukrs&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;tvko-bukrs,<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_buzei&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bseg-buzei,<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_gjahr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bseg-gjahr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_mwskz&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bset-mwskz,<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_mwsatz&nbsp;&nbsp;&nbsp;TYPE&nbsp;t076m-mwsatz,<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_kbetr&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;bset-kbetr,<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_impuesto&nbsp;TYPE&nbsp;p&nbsp;&nbsp;DECIMALS&nbsp;3.<br />
<br />
&nbsp;&nbsp;"tax_code<br />
&nbsp;&nbsp;SELECT&nbsp;buzei&nbsp;gjahr&nbsp;INTO&nbsp;(&nbsp;vl_buzei,&nbsp;vl_gjahr&nbsp;)<br />
&nbsp;&nbsp;FROM&nbsp;bseg&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;WHERE&nbsp;bukrs&nbsp;EQ&nbsp;vbdkr-bukrs&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;belnr&nbsp;EQ&nbsp;vbdkr-vbeln&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gjahr&nbsp;EQ&nbsp;vbdkr-fkdat+0(4)&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;koart&nbsp;EQ&nbsp;'D'<br />
&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;PRIMARY&nbsp;KEY.<br />
&nbsp;&nbsp;ENDSELECT.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;mwskz&nbsp;kbetr&nbsp;INTO&nbsp;(&nbsp;vl_mwskz,&nbsp;vl_kbetr&nbsp;)<br />
&nbsp;&nbsp;FROM&nbsp;bset&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;WHERE&nbsp;bukrs&nbsp;EQ&nbsp;vbdkr-bukrs&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;belnr&nbsp;EQ&nbsp;vbdkr-vbeln&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gjahr&nbsp;EQ&nbsp;vl_gjahr&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buzei&nbsp;EQ&nbsp;vl_buzei<br />
&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;PRIMARY&nbsp;KEY.<br />
&nbsp;&nbsp;ENDSELECT.<br />
<br />
&nbsp;&nbsp;IF&nbsp;vl_kbetr&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;tkomv&nbsp;WITH&nbsp;KEY&nbsp;kbetr&nbsp;=&nbsp;vl_kbetr.<br />
&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;tkomv-krech&nbsp;=&nbsp;'A'&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tkomv-waers&nbsp;=&nbsp;''.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Valor&nbsp;Porcentual&nbsp;!<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;vl_kbetr&nbsp;&gt;&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_impuesto&nbsp;&nbsp;=&nbsp;vl_kbetr&nbsp;/&nbsp;10.&nbsp;"&nbsp;190,00&nbsp;--&gt;&nbsp;19.000<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl_mwsatz&nbsp;=&nbsp;vl_impuesto.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONDENSE&nbsp;vl_mwsatz.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;vl_mwsatz&nbsp;=&nbsp;'0.000'.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;mwskz&nbsp;INTO&nbsp;vl_mwskz<br />
&nbsp;&nbsp;FROM&nbsp;t076m&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;WHERE&nbsp;parart&nbsp;=&nbsp;'LI'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;konto&nbsp;&nbsp;=&nbsp;gv_kunnr&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mwart&nbsp;&nbsp;=&nbsp;vl_mwskz&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;land1&nbsp;&nbsp;=&nbsp;vbdkr-landa&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mwsatz&nbsp;=&nbsp;vl_mwsatz<br />
&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;PRIMARY&nbsp;KEY.<br />
&nbsp;&nbsp;ENDSELECT.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gv_tax_code&nbsp;=&nbsp;vl_mwskz.<br />
&nbsp;&nbsp;ELSE.<br />
&nbsp;&nbsp;&nbsp;&nbsp;gv_tax_code&nbsp;=&nbsp;'C0'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;sin&nbsp;impuestos<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
ENDFORM. " tax_code<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_CURRENCYAMOUNT_PROV<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_currencyamount_prov.<br />
&nbsp;&nbsp;DATA&nbsp;vl_netwr&nbsp;TYPE&nbsp;netwr.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;Define&nbsp;factor&nbsp;+/-<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CASE&nbsp;vbdkr-vbtyp.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'M'.&nbsp;"&nbsp;(KR)&nbsp;Factura<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_factor&nbsp;=&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'O'.&nbsp;"&nbsp;(KC)&nbsp;Nota&nbsp;de&nbsp;Credito<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_factor&nbsp;=&nbsp;&nbsp;1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;'P'.&nbsp;"&nbsp;(KD)&nbsp;Nota&nbsp;de&nbsp;Debito<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gv_factor&nbsp;=&nbsp;-1.<br />
&nbsp;&nbsp;&nbsp;&nbsp;WHEN&nbsp;OTHERS.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syst-msgty&nbsp;=&nbsp;'E'.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PERFORM&nbsp;protocol_update&nbsp;IN&nbsp;PROGRAM&nbsp;rvadin01.<br />
&nbsp;&nbsp;ENDCASE.<br />
<br />
   </div>
   <div class="codeComment">
*&nbsp;De&nbsp;la&nbsp;linea&nbsp;del&nbsp;proveedor&nbsp;Accountoayable&nbsp;(-)&nbsp;,&nbsp;accountgl(+)<br />
   </div>
   <div class="code">
&nbsp;&nbsp;stg_currencyamount-itemno_acc&nbsp;=&nbsp;'1'.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;posici�n&nbsp;del&nbsp;documento&nbsp;FI<br />
&nbsp;&nbsp;stg_currencyamount-currency&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk.&nbsp;"&nbsp;Moneda<br />
   </div>
   <div class="codeComment">
*vl_netwr&nbsp;=&nbsp;vbdkr-netwr&nbsp;+&nbsp;vbdkr-mwsbk.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"&nbsp;Importe<br />
<br />
   </div>
   <div class="code">
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk&nbsp;"&nbsp;Moneda<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;vbdkr-netwr&nbsp;"&nbsp;Monto&nbsp;neto<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_doccur.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-amt_doccur&nbsp;=&nbsp;stg_currencyamount-amt_doccur&nbsp;*&nbsp;gv_factor.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk&nbsp;"&nbsp;Moneda<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;vbdkr-netwr&nbsp;"&nbsp;Monto&nbsp;neto<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_base.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-amt_base&nbsp;=&nbsp;stg_currencyamount-amt_base&nbsp;*&nbsp;gv_factor.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk&nbsp;"&nbsp;Moneda<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;vbdkr-mwsbk&nbsp;"&nbsp;Impuesto<br />
&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-tax_amt.<br />
&nbsp;&nbsp;IF&nbsp;sy-subrc&nbsp;EQ&nbsp;0.<br />
&nbsp;&nbsp;&nbsp;&nbsp;stg_currencyamount-tax_amt&nbsp;=&nbsp;stg_currencyamount-tax_amt&nbsp;*&nbsp;gv_factor.<br />
&nbsp;&nbsp;ENDIF.<br />
<br />
&nbsp;&nbsp;APPEND&nbsp;stg_currencyamount&nbsp;TO&nbsp;itg_currencyamount.<br />
&nbsp;&nbsp;CLEAR&nbsp;stg_currencyamount.<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;Numero_cuenta<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM cuenta_mayor USING p_skont TYPE t076i-skont<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_matnr&nbsp;TYPE&nbsp;matnr.<br />
<br />
&nbsp;&nbsp;SELECT&nbsp;skont&nbsp;INTO&nbsp;p_skont<br />
&nbsp;&nbsp;FROM&nbsp;t076i&nbsp;UP&nbsp;TO&nbsp;1&nbsp;ROWS<br />
&nbsp;&nbsp;WHERE&nbsp;parart&nbsp;&nbsp;=&nbsp;'LI'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;konto&nbsp;&nbsp;&nbsp;=&nbsp;gv_kunnr&nbsp;&nbsp;&nbsp;&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ktbukrs&nbsp;=&nbsp;vbdkr-vbund&nbsp;AND<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ewlnr&nbsp;&nbsp;&nbsp;=&nbsp;p_matnr<br />
&nbsp;&nbsp;ORDER&nbsp;BY&nbsp;PRIMARY&nbsp;KEY.<br />
&nbsp;&nbsp;ENDSELECT.<br />
<br />
ENDFORM.<br />
   </div>
   <div class="codeComment">
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_ACCOUNTTAX_POS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_accounttax_prov.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;stg_accounttax-itemno_acc&nbsp;=&nbsp;'1'.<br />
*&nbsp;&nbsp;stg_accounttax-tax_code&nbsp;&nbsp;&nbsp;=&nbsp;'C1'.<br />
*&nbsp;&nbsp;APPEND&nbsp;stg_accounttax&nbsp;TO&nbsp;itg_accounttax.<br />
*&nbsp;&nbsp;CLEAR&nbsp;stg_accounttax.<br />
   </div>
   <div class="code">
ENDFORM.<br />
   </div>
   <div class="codeComment">
**&---------------------------------------------------------------------*<br />
**&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_CURRENCYAMOUNT_TAX<br />
**&---------------------------------------------------------------------*<br />
**&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
**----------------------------------------------------------------------*<br />
**&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
**&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
**----------------------------------------------------------------------*<br />
*FORM&nbsp;fill_currencyamount_tax_prov.<br />
*&nbsp;&nbsp;DATA&nbsp;vl_itemno_acc&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;posnr_acc.<br />
*&nbsp;&nbsp;DATA&nbsp;stg_aux_currency&nbsp;TYPE&nbsp;bapiaccr09.<br />
*<br />
*&nbsp;&nbsp;CLEAR&nbsp;gv_lines.<br />
*&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;itg_currencyamount&nbsp;LINES&nbsp;gv_lines.<br />
*<br />
*&nbsp;&nbsp;CLEAR&nbsp;stg_aux_currency.<br />
*&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_currencyamount&nbsp;INTO&nbsp;stg_aux_currency&nbsp;INDEX&nbsp;gv_lines.<br />
*&nbsp;&nbsp;IF&nbsp;stg_aux_currency&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;vl_itemno_acc&nbsp;=&nbsp;stg_aux_currency-itemno_acc&nbsp;+&nbsp;1.<br />
*&nbsp;&nbsp;ENDIF.<br />
*<br />
*&nbsp;&nbsp;stg_currencyamount-itemno_acc&nbsp;=&nbsp;vl_itemno_acc.&nbsp;"&nbsp;N�mero&nbsp;de&nbsp;posici�n&nbsp;del&nbsp;documento&nbsp;FI<br />
*&nbsp;&nbsp;stg_currencyamount-currency&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk.&nbsp;&nbsp;&nbsp;"&nbsp;Clave&nbsp;de&nbsp;moneda<br />
*<br />
*&nbsp;&nbsp;"&nbsp;Importe&nbsp;en&nbsp;moneda&nbsp;de&nbsp;documento<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk&nbsp;"&nbsp;Moneda<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;vbdkr-mwsbk&nbsp;"&nbsp;Monto<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_doccur.<br />
*<br />
*&nbsp;&nbsp;"&nbsp;Importe&nbsp;base&nbsp;del&nbsp;impuesto&nbsp;en&nbsp;moneda&nbsp;documento<br />
*&nbsp;&nbsp;CALL&nbsp;FUNCTION&nbsp;'BAPI_CURRENCY_CONV_TO_EXTERNAL'<br />
*&nbsp;&nbsp;&nbsp;&nbsp;EXPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currency&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;vbdkr-waerk&nbsp;"&nbsp;Moneda<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_internal&nbsp;=&nbsp;vbdkr-netwr&nbsp;"&nbsp;Monto<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IMPORTING<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount_external&nbsp;=&nbsp;stg_currencyamount-amt_base.<br />
*<br />
*&nbsp;&nbsp;APPEND&nbsp;stg_currencyamount&nbsp;TO&nbsp;itg_currencyamount.<br />
*&nbsp;&nbsp;CLEAR&nbsp;stg_currencyamount.<br />
*<br />
*ENDFORM.<br />
*&---------------------------------------------------------------------*<br />
*&&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Form&nbsp;&nbsp;FILL_ACCOUNTTAX_POS<br />
*&---------------------------------------------------------------------*<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
*&nbsp;&nbsp;--&gt;&nbsp;&nbsp;p1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*&nbsp;&nbsp;&lt;--&nbsp;&nbsp;p2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text<br />
*----------------------------------------------------------------------*<br />
   </div>
   <div class="code">
FORM fill_accounttax_pos USING p_itemno_acc TYPE posnr_acc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p_skont&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TYPE&nbsp;t076i-skont.<br />
   </div>
   <div class="codeComment">
*&nbsp;&nbsp;DATA&nbsp;aux_accounttax&nbsp;TYPE&nbsp;bapiactx09.<br />
*&nbsp;&nbsp;CLEAR&nbsp;gv_lines.<br />
*&nbsp;&nbsp;DESCRIBE&nbsp;TABLE&nbsp;itg_accounttax&nbsp;LINES&nbsp;gv_lines.<br />
*&nbsp;&nbsp;IF&nbsp;gv_lines&nbsp;&gt;&nbsp;0.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;CLEAR&nbsp;aux_accounttax.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;READ&nbsp;TABLE&nbsp;itg_accounttax&nbsp;INTO&nbsp;aux_accounttax&nbsp;INDEX&nbsp;gv_lines.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;IF&nbsp;aux_accounttax&nbsp;IS&nbsp;NOT&nbsp;INITIAL.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stg_accounttax-itemno_acc&nbsp;=&nbsp;aux_accounttax-itemno_acc&nbsp;+&nbsp;1.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;ENDIF.<br />
*&nbsp;&nbsp;ELSE.<br />
*&nbsp;&nbsp;&nbsp;&nbsp;stg_accounttax-itemno_acc&nbsp;=&nbsp;'2'.<br />
*&nbsp;&nbsp;ENDIF.<br />
<br />
*&nbsp;&nbsp;stg_accounttax-itemno_acc&nbsp;=&nbsp;p_itemno_acc.<br />
*&nbsp;&nbsp;stg_accounttax-tax_code&nbsp;&nbsp;&nbsp;=&nbsp;'C1'.<br />
*&nbsp;&nbsp;stg_accounttax-gl_account&nbsp;=&nbsp;p_skont.<br />
*&nbsp;&nbsp;APPEND&nbsp;stg_accounttax&nbsp;TO&nbsp;itg_accounttax.<br />
*&nbsp;&nbsp;CLEAR&nbsp;stg_accounttax.<br />
<br />
*tb_accounttax-itemno_acc&nbsp;=&nbsp;3.<br />
*tb_accounttax-gl_account&nbsp;=&nbsp;'0000121710'.<br />
*tb_accounttax-tax_code&nbsp;=&nbsp;'P1'.<br />
*tb_accounttax-TAX_RATE&nbsp;=&nbsp;'20'.<br />
   </div>
   <div class="code">
ENDFORM.<br />
            </div>
          </td>
        </tr>
      </table>
      </td>
      </tr>
   <tr>
<td class="footer">Extracted by Mass Download version 1.5.5 - E.G.Mellodew. 1998-2019. Sap Release 750</td>
   </tr>
</table>
</body>
</html>
